<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>PagedGeometry: /home/thomas/meteor-falls/meteor-falls-src/libs/ogre-paged/include/ImpostorPage.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">PagedGeometry
   &#160;<span id="projectnumber">1.1.4</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/thomas/meteor-falls/meteor-falls-src/libs/ogre-paged/include/ImpostorPage.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*-------------------------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">Copyright (c) 2006 John Judnich</span>
<a name="l00003"></a>00003 <span class="comment">Modified 2008 by Erik Hjortsberg (erik.hjortsberg@iteam.se)</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">This software is provided &#39;as-is&#39;, without any express or implied warranty. In no event will the authors be held liable for any damages arising from the use of this software.</span>
<a name="l00006"></a>00006 <span class="comment">Permission is granted to anyone to use this software for any purpose, including commercial applications, and to alter it and redistribute it freely, subject to the following restrictions:</span>
<a name="l00007"></a>00007 <span class="comment">1. The origin of this software must not be misrepresented; you must not claim that you wrote the original software. If you use this software in a product, an acknowledgment in the product documentation would be appreciated but is not required.</span>
<a name="l00008"></a>00008 <span class="comment">2. Altered source versions must be plainly marked as such, and must not be misrepresented as being the original software.</span>
<a name="l00009"></a>00009 <span class="comment">3. This notice may not be removed or altered from any source distribution.</span>
<a name="l00010"></a>00010 <span class="comment">-------------------------------------------------------------------------------------*/</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="comment">//ImpostorPage.h</span>
<a name="l00013"></a>00013 <span class="comment">//ImposterPage is an extension to PagedGeometry which displays entities as imposters.</span>
<a name="l00014"></a>00014 <span class="comment">//-------------------------------------------------------------------------------------</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#ifndef __ImpostorPage_H__</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#define __ImpostorPage_H__</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;PagedGeometry.h&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;StaticBillboardSet.h&quot;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;OgrePrerequisites.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;OgreTextureManager.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;OgreRenderTexture.h&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#if OGRE_PLATFORM == OGRE_PLATFORM_LINUX</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="comment">// linux memory fix</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;memory&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#endif</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="comment">//The number of angle increments around the yaw axis to render impostor &quot;snapshots&quot; of trees</span>
<a name="l00032"></a>00032 <span class="preprocessor">#define IMPOSTOR_YAW_ANGLES 8</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>
<a name="l00034"></a>00034 <span class="comment">//The number of angle increments around the pitch axis to render impostor &quot;snapshots&quot; of trees</span>
<a name="l00035"></a>00035 <span class="preprocessor">#define IMPOSTOR_PITCH_ANGLES 4</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="comment">//When IMPOSTOR_RENDER_ABOVE_ONLY is defined, impostor images will only be rendered from angles around and</span>
<a name="l00038"></a>00038 <span class="comment">//above entities. If this is disabled, bottom views of the entities will be rendered to the impostor atlas</span>
<a name="l00039"></a>00039 <span class="comment">//and therefore allow those angles to be viewed from a distance. However, this requires the IMPOSTOR_PITCH_ANGLES</span>
<a name="l00040"></a>00040 <span class="comment">//to be doubled to maintain an equal level of impostor angle correctness compared to when impostors are rendered</span>
<a name="l00041"></a>00041 <span class="comment">//from above only.</span>
<a name="l00042"></a>00042 <span class="preprocessor">#define IMPOSTOR_RENDER_ABOVE_ONLY</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a>00044 <span class="comment">//When IMPOSTOR_FILE_SAVE is defined, impostor textures will be read and saved to disc; if not, they will stay</span>
<a name="l00045"></a>00045 <span class="comment">//in memory and need to be regenerated each time the application is run (remove or comment out the line below if this</span>
<a name="l00046"></a>00046 <span class="comment">//is desired)</span>
<a name="l00047"></a>00047 <span class="preprocessor">#define IMPOSTOR_FILE_SAVE</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="keyword">namespace </span>Forests
<a name="l00050"></a>00050 {
<a name="l00051"></a>00051    <span class="comment">// Forward declaration</span>
<a name="l00052"></a>00052    <span class="keyword">class </span>ImpostorBatch;
<a name="l00053"></a>00053    <span class="keyword">class </span>ImpostorTexture;
<a name="l00054"></a>00054 
<a name="l00056"></a>00056    <span class="keyword">enum</span> ImpostorBlendMode
<a name="l00057"></a>00057    {
<a name="l00058"></a>00058       ALPHA_REJECT_IMPOSTOR,
<a name="l00059"></a>00059       ALPHA_BLEND_IMPOSTOR
<a name="l00060"></a>00060    };
<a name="l00061"></a>00061 
<a name="l00062"></a>00062    <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00084"></a><a class="code" href="classForests_1_1ImpostorPage.html">00084</a> <span class="comment"></span>   <span class="keyword">class </span><a class="code" href="classForests_1_1ImpostorPage.html" title="The ImpostorPage class renders entities as impostors (billboard images that look just like the real e...">ImpostorPage</a>: <span class="keyword">public</span> GeometryPage
<a name="l00085"></a>00085    {
<a name="l00086"></a>00086       <span class="keyword">typedef</span> std::map&lt;Ogre::String, ImpostorBatch*&gt; TImpostorBatchs;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088    <span class="keyword">public</span>:
<a name="l00089"></a>00089       <a class="code" href="classForests_1_1ImpostorPage.html#adbcad1186f91b098257252776b886197" title="Default constructor.">ImpostorPage</a>();
<a name="l00090"></a>00090       <a class="code" href="classForests_1_1ImpostorPage.html#aad744d0a5c1dcfe68cf2247ce0edbe4c" title="Destructor.">~ImpostorPage</a>();
<a name="l00091"></a>00091 
<a name="l00092"></a>00092       <span class="keywordtype">void</span> init(PagedGeometry *geom, <span class="keyword">const</span> Ogre::Any &amp;data);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094       <span class="keywordtype">void</span> setRegion(Ogre::Real left, Ogre::Real top, Ogre::Real right, Ogre::Real bottom);
<a name="l00095"></a>00095       <span class="keywordtype">void</span> addEntity(Ogre::Entity *ent, <span class="keyword">const</span> Ogre::Vector3 &amp;position, <span class="keyword">const</span> Ogre::Quaternion &amp;rotation,
<a name="l00096"></a>00096          <span class="keyword">const</span> Ogre::Vector3 &amp;scale, <span class="keyword">const</span> Ogre::ColourValue &amp;color);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098       <span class="keywordtype">void</span> build();
<a name="l00099"></a>00099       <span class="keywordtype">void</span> removeEntities();
<a name="l00100"></a>00100       <span class="keywordtype">void</span> setVisible(<span class="keywordtype">bool</span> visible);
<a name="l00101"></a>00101       <span class="keywordtype">void</span> setFade(<span class="keywordtype">bool</span> enabled, Ogre::Real visibleDist, Ogre::Real invisibleDist);
<a name="l00102"></a>00102       <span class="keywordtype">void</span> update();
<a name="l00103"></a>00103 
<a name="l00104"></a>00104       PagedGeometry* getParentPagedGeometry()<span class="keyword"> const   </span>{ <span class="keywordflow">return</span> m_pPagedGeom; }
<a name="l00105"></a>00105       <span class="keywordtype">void</span> setBlendMode(ImpostorBlendMode blendMode)  { m_blendMode = blendMode; }
<a name="l00106"></a>00106       ImpostorBlendMode getBlendMode()<span class="keyword"> const          </span>{ <span class="keywordflow">return</span> m_blendMode; }
<a name="l00107"></a>00107 
<a name="l00109"></a>00109       <a class="code" href="classForests_1_1ImpostorBatch.html">ImpostorBatch</a>* getImpostorBatch(<span class="keyword">const</span> Ogre::String &amp;key)<span class="keyword"> const</span>
<a name="l00110"></a>00110 <span class="keyword">      </span>{
<a name="l00111"></a>00111          TImpostorBatchs::const_iterator it = m_mapImpostorBatches.find(key);
<a name="l00112"></a>00112          <span class="keywordflow">return</span> it != m_mapImpostorBatches.end() ? it-&gt;second : NULL;
<a name="l00113"></a>00113       }
<a name="l00114"></a>00114 
<a name="l00116"></a>00116       <span class="keywordtype">bool</span> injectImpostorBatch(<span class="keyword">const</span> Ogre::String &amp;key, <a class="code" href="classForests_1_1ImpostorBatch.html">ImpostorBatch</a> *injectedBatch)
<a name="l00117"></a>00117       {
<a name="l00118"></a>00118          <span class="keywordflow">return</span> injectedBatch ?
<a name="l00119"></a>00119             m_mapImpostorBatches.insert(TImpostorBatchs::value_type(key, injectedBatch)).second : <span class="keyword">false</span>;
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 
<a name="l00123"></a>00123       <span class="comment">// Static functions</span>
<a name="l00124"></a>00124 
<a name="l00136"></a><a class="code" href="classForests_1_1ImpostorPage.html#a7ae14ab7231241165e83c76d41f109b7">00136</a>       <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classForests_1_1ImpostorPage.html#a7ae14ab7231241165e83c76d41f109b7" title="Sets the resolution for single impostor images.">setImpostorResolution</a>(Ogre::uint pixels)  { s_nImpostorResolution = pixels; }
<a name="l00137"></a>00137       <span class="keyword">static</span> Ogre::uint getImpostorResolution()             { <span class="keywordflow">return</span> s_nImpostorResolution; }
<a name="l00138"></a>00138 
<a name="l00157"></a><a class="code" href="classForests_1_1ImpostorPage.html#a086bfdd3b3c31237c8a1a8d3a175527d">00157</a>       <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classForests_1_1ImpostorPage.html#a086bfdd3b3c31237c8a1a8d3a175527d" title="Sets the background color used when rendering impostor images.">setImpostorBackgroundColor</a>(<span class="keyword">const</span> Ogre::ColourValue &amp;color)
<a name="l00158"></a>00158       {
<a name="l00159"></a>00159          s_clrImpostorBackground = color;
<a name="l00160"></a>00160          s_clrImpostorBackground.a = 0.0f;
<a name="l00161"></a>00161       }
<a name="l00162"></a>00162 
<a name="l00164"></a>00164       <span class="keyword">static</span> <span class="keyword">const</span> Ogre::ColourValue&amp; getImpostorBackgroundColor() { <span class="keywordflow">return</span> s_clrImpostorBackground; }
<a name="l00165"></a>00165 
<a name="l00181"></a><a class="code" href="classForests_1_1ImpostorPage.html#a2edfc63403c228645d63638224df4c3e">00181</a>       <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classForests_1_1ImpostorPage.html#a2edfc63403c228645d63638224df4c3e" title="Sets the billboard pivot point used when rendering camera-facing impostors.">setImpostorPivot</a>(Ogre::BillboardOrigin origin)
<a name="l00182"></a>00182       {
<a name="l00183"></a>00183          <span class="keywordflow">if</span> (origin != Ogre::BBO_CENTER &amp;&amp; origin != Ogre::BBO_BOTTOM_CENTER)
<a name="l00184"></a>00184          {
<a name="l00185"></a>00185             OGRE_EXCEPT(Ogre::Exception::ERR_INVALIDPARAMS,
<a name="l00186"></a>00186                <span class="stringliteral">&quot;Invalid origin - only BBO_CENTER and BBO_BOTTOM_CENTER is supported&quot;</span>,
<a name="l00187"></a>00187                <span class="stringliteral">&quot;ImpostorPage::setImpostorPivot()&quot;</span>);
<a name="l00188"></a>00188          }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190          s_impostorPivot = origin;
<a name="l00191"></a>00191       }
<a name="l00192"></a>00192 
<a name="l00194"></a>00194       <span class="keyword">static</span> Ogre::BillboardOrigin getImpostorPivot() { <span class="keywordflow">return</span> s_impostorPivot; }
<a name="l00195"></a>00195 
<a name="l00210"></a>00210       <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classForests_1_1ImpostorPage.html#a3a66d8bc95c0a841d9737e9372e4b694" title="Regenerates the impostor texture for the specified entity.">regenerate</a>(Ogre::Entity *ent);
<a name="l00211"></a>00211 
<a name="l00222"></a>00222       <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classForests_1_1ImpostorPage.html#a3af23c1bd6c9d3001d7bf47bbd0c59ad" title="Regenerates all impostor textures currently being used in the scene.">regenerateAll</a>();
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00225"></a>00225    <span class="keyword">protected</span>:
<a name="l00226"></a>00226       Ogre::SceneManager*           m_pSceneMgr;               
<a name="l00227"></a>00227       PagedGeometry*                m_pPagedGeom;              
<a name="l00228"></a>00228       ImpostorBlendMode             m_blendMode;               
<a name="l00229"></a>00229       Ogre::uint                    m_nInstanceID;             
<a name="l00230"></a>00230       Ogre::uint                    m_nAveCount;               
<a name="l00231"></a>00231       Ogre::Vector3                 m_vecCenter;               
<a name="l00232"></a>00232       Ogre::Timer                   m_timerUpdate;             
<a name="l00233"></a>00233       TImpostorBatchs               m_mapImpostorBatches;      
<a name="l00234"></a>00234 
<a name="l00235"></a>00235    <span class="keyword">private</span>:
<a name="l00236"></a>00236 
<a name="l00237"></a>00237       <span class="keyword">static</span> Ogre::uint             s_nImpostorResolution;     
<a name="l00238"></a>00238       <span class="keyword">static</span> Ogre::uint             s_nSelfInstances;          
<a name="l00239"></a>00239       <span class="keyword">static</span> Ogre::uint             s_nUpdateInstanceID;       
<a name="l00240"></a>00240       <span class="keyword">static</span> Ogre::ColourValue      s_clrImpostorBackground;   
<a name="l00241"></a>00241       <span class="keyword">static</span> Ogre::BillboardOrigin  s_impostorPivot;           
<a name="l00242"></a>00242    }; <span class="comment">// end class ImpostorPage</span>
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 
<a name="l00245"></a>00245    <span class="comment">//-------------------------------------------------------------------------------------</span>
<a name="l00246"></a>00246    <span class="comment">//This is used internally by ImpostorPage to store a &quot;batch&quot; of impostors. Similar</span>
<a name="l00247"></a>00247    <span class="comment">//impostors are all batched into ImpostorBatch&#39;es, which contain a BillboardSet (where</span>
<a name="l00248"></a>00248    <span class="comment">//the actual billboards are), and a pointer to an existing ImpostorTexture.</span>
<a name="l00249"></a><a class="code" href="classForests_1_1ImpostorBatch.html">00249</a>    <span class="keyword">class </span><a class="code" href="classForests_1_1ImpostorBatch.html">ImpostorBatch</a>
<a name="l00250"></a>00250    {
<a name="l00251"></a>00251    <span class="keyword">public</span>:
<a name="l00252"></a>00252       <span class="keyword">static</span> <a class="code" href="classForests_1_1ImpostorBatch.html">ImpostorBatch</a> *getBatch(<a class="code" href="classForests_1_1ImpostorPage.html" title="The ImpostorPage class renders entities as impostors (billboard images that look just like the real e...">ImpostorPage</a> *group, Ogre::Entity *entity);
<a name="l00253"></a>00253       ~<a class="code" href="classForests_1_1ImpostorBatch.html">ImpostorBatch</a>();
<a name="l00254"></a>00254 
<a name="l00255"></a>00255       <span class="keyword">inline</span> <span class="keywordtype">void</span> build()
<a name="l00256"></a>00256       {
<a name="l00257"></a>00257          bbset-&gt;<a class="code" href="classForests_1_1StaticBillboardSet.html#a7569f1abc6cb72680e7b9a1738a981f5" title="Performs final steps required for the created billboards to appear in the scene.">build</a>();
<a name="l00258"></a>00258       }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260       <span class="keyword">inline</span> <span class="keywordtype">void</span> clear()
<a name="l00261"></a>00261       {
<a name="l00262"></a>00262          bbset-&gt;<a class="code" href="classForests_1_1StaticBillboardSet.html#adb629bfecc9a87c35e007c870aaea9c5" title="Deletes all billboards from the scene.">clear</a>();
<a name="l00263"></a>00263       }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265       <span class="keyword">inline</span> <span class="keywordtype">void</span> setVisible(<span class="keywordtype">bool</span> visible)
<a name="l00266"></a>00266       {
<a name="l00267"></a>00267          bbset-&gt;<a class="code" href="classForests_1_1StaticBillboardSet.html#a7e57b6ba7f729671152c47182fdad51f" title="Sets whether or not this StaticBillboardSet will be rendered.">setVisible</a>(visible);
<a name="l00268"></a>00268       }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270       <span class="keyword">inline</span> <span class="keywordtype">void</span> setFade(<span class="keywordtype">bool</span> enabled, Ogre::Real visibleDist, Ogre::Real invisibleDist)
<a name="l00271"></a>00271       {
<a name="l00272"></a>00272          bbset-&gt;<a class="code" href="classForests_1_1StaticBillboardSet.html#a331cebf53f34ea277dc8afa71a84a86b" title="Enables/disables distance fade-out for this billboard set.">setFade</a>(enabled, visibleDist, invisibleDist);
<a name="l00273"></a>00273       }
<a name="l00274"></a>00274 
<a name="l00276"></a>00276       <span class="keywordtype">void</span> setBillboardOrigin(Ogre::BillboardOrigin origin);
<a name="l00278"></a>00278       <span class="keywordtype">void</span> addBillboard(<span class="keyword">const</span> Ogre::Vector3 &amp;position, <span class="keyword">const</span> Ogre::Quaternion &amp;rotation,
<a name="l00279"></a>00279          <span class="keyword">const</span> Ogre::Vector3 &amp;scale, <span class="keyword">const</span> Ogre::ColourValue &amp;color = Ogre::ColourValue::White);
<a name="l00281"></a>00281       <span class="keywordtype">void</span> setAngle(Ogre::Real pitchDeg, Ogre::Real yawDeg);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283       <span class="keyword">static</span> Ogre::String generateEntityKey(Ogre::Entity *entity);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285    <span class="keyword">protected</span>:
<a name="l00286"></a>00286       <a class="code" href="classForests_1_1ImpostorBatch.html">ImpostorBatch</a>(<a class="code" href="classForests_1_1ImpostorPage.html" title="The ImpostorPage class renders entities as impostors (billboard images that look just like the real e...">ImpostorPage</a> *group, Ogre::Entity *entity);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288       <a class="code" href="classForests_1_1ImpostorTexture.html">ImpostorTexture</a>*     m_pTexture;
<a name="l00289"></a>00289       <a class="code" href="classForests_1_1StaticBillboardSet.html" title="A faster alternative to Ogre&#39;s built-in BillboardSet class.">StaticBillboardSet</a> *bbset;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291       Ogre::Vector3 entityBBCenter;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293       <a class="code" href="classForests_1_1ImpostorPage.html" title="The ImpostorPage class renders entities as impostors (billboard images that look just like the real e...">ImpostorPage</a> *igroup;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295       Ogre::uint16 pitchIndex, yawIndex;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297       <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> GUID;
<a name="l00298"></a>00298       <span class="keyword">static</span> <span class="keyword">inline</span> Ogre::String getUniqueID(<span class="keyword">const</span> Ogre::String &amp;prefix)
<a name="l00299"></a>00299       {
<a name="l00300"></a>00300          <span class="keywordflow">return</span> prefix + Ogre::StringConverter::toString(++GUID);
<a name="l00301"></a>00301       }
<a name="l00302"></a>00302    };
<a name="l00303"></a>00303 
<a name="l00304"></a>00304    <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00307"></a><a class="code" href="classForests_1_1ImpostorTextureResourceLoader.html">00307</a> <span class="comment"></span>   <span class="keyword">class </span><a class="code" href="classForests_1_1ImpostorTextureResourceLoader.html" title="Responsible for making sure that the texture is rerendered when the texture resource needs to be relo...">ImpostorTextureResourceLoader</a> : <span class="keyword">public</span> Ogre::ManualResourceLoader
<a name="l00308"></a>00308    {
<a name="l00309"></a>00309    <span class="keyword">public</span>:
<a name="l00314"></a>00314       <a class="code" href="classForests_1_1ImpostorTextureResourceLoader.html#af882412c3c3d85fff70db7d078e7a568" title="Ctor.">ImpostorTextureResourceLoader</a>(<a class="code" href="classForests_1_1ImpostorTexture.html">ImpostorTexture</a>&amp; impostorTexture);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00321"></a>00321       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classForests_1_1ImpostorTextureResourceLoader.html#a476da035aea36b2460c4fe8a61f0e864" title="At load time the texture will be rerendered.">loadResource</a> (Ogre::Resource *resource);
<a name="l00322"></a>00322    <span class="keyword">protected</span>:
<a name="l00323"></a>00323       <a class="code" href="classForests_1_1ImpostorTexture.html">ImpostorTexture</a>&amp; texture;
<a name="l00324"></a>00324    };
<a name="l00325"></a>00325 
<a name="l00326"></a>00326    <span class="comment">//-------------------------------------------------------------------------------------</span>
<a name="l00327"></a>00327    <span class="comment">//This is used internally by ImpostorPage. An ImpostorTexture is actually multiple</span>
<a name="l00328"></a>00328    <span class="comment">//images of an entity from various rotations. ImpostorTextures are applied</span>
<a name="l00329"></a>00329    <span class="comment">//to billboards to create the effect of 3D shapes, when in reality they are simply</span>
<a name="l00330"></a>00330    <span class="comment">//flat billboards.</span>
<a name="l00331"></a><a class="code" href="classForests_1_1ImpostorTexture.html">00331</a>    <span class="keyword">class </span><a class="code" href="classForests_1_1ImpostorTexture.html">ImpostorTexture</a>
<a name="l00332"></a>00332    {
<a name="l00333"></a>00333       <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classForests_1_1ImpostorBatch.html">ImpostorBatch</a>;
<a name="l00334"></a>00334       <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classForests_1_1ImpostorTextureResourceLoader.html" title="Responsible for making sure that the texture is rerendered when the texture resource needs to be relo...">ImpostorTextureResourceLoader</a>;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336    <span class="keyword">public</span>:
<a name="l00340"></a>00340       <span class="keyword">static</span> <a class="code" href="classForests_1_1ImpostorTexture.html">ImpostorTexture</a> *<a class="code" href="classForests_1_1ImpostorTexture.html#a84e2aaf969267377cbf28e4cfc9227d8" title="Returns a pointer to an ImpostorTexture for the specified entity.">getTexture</a>(<a class="code" href="classForests_1_1ImpostorPage.html" title="The ImpostorPage class renders entities as impostors (billboard images that look just like the real e...">ImpostorPage</a> *group, Ogre::Entity *entity);
<a name="l00341"></a>00341 
<a name="l00346"></a>00346       <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classForests_1_1ImpostorTexture.html#ab6ae409b5485f960c0a6ab4733eacc18" title="remove created texture, note that all of the ImposterTextures must be deleted at once, because there is no track if a texture is still being used by something else">removeTexture</a>(<a class="code" href="classForests_1_1ImpostorTexture.html">ImpostorTexture</a>* Texture);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348       <span class="keywordtype">void</span> regenerate();
<a name="l00349"></a>00349       <span class="keyword">static</span> <span class="keywordtype">void</span> regenerateAll();
<a name="l00350"></a>00350 
<a name="l00351"></a>00351       ~<a class="code" href="classForests_1_1ImpostorTexture.html">ImpostorTexture</a>();
<a name="l00352"></a>00352 
<a name="l00353"></a>00353    <span class="keyword">protected</span>:
<a name="l00354"></a>00354       <a class="code" href="classForests_1_1ImpostorTexture.html">ImpostorTexture</a>(<a class="code" href="classForests_1_1ImpostorPage.html" title="The ImpostorPage class renders entities as impostors (billboard images that look just like the real e...">ImpostorPage</a> *group, Ogre::Entity *entity);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356       <span class="keywordtype">void</span> renderTextures(<span class="keywordtype">bool</span> force);  <span class="comment">// Renders the impostor texture grid</span>
<a name="l00357"></a>00357       <span class="keywordtype">void</span> updateMaterials();               <span class="comment">// Updates the materials to use the latest rendered impostor texture grid</span>
<a name="l00358"></a>00358 
<a name="l00359"></a>00359       Ogre::String removeInvalidCharacters(Ogre::String s);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361       <span class="keyword">static</span> std::map&lt;Ogre::String, ImpostorTexture *&gt; selfList;
<a name="l00362"></a>00362       Ogre::SceneManager *sceneMgr;
<a name="l00363"></a>00363       Ogre::Entity *entity;
<a name="l00364"></a>00364       Ogre::String entityKey;
<a name="l00365"></a>00365       <a class="code" href="classForests_1_1ImpostorPage.html" title="The ImpostorPage class renders entities as impostors (billboard images that look just like the real e...">ImpostorPage</a> *group;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367       Ogre::MaterialPtr material[IMPOSTOR_PITCH_ANGLES][IMPOSTOR_YAW_ANGLES];
<a name="l00368"></a>00368       Ogre::TexturePtr texture;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370       Ogre::ResourceHandle sourceMesh;
<a name="l00371"></a>00371       Ogre::AxisAlignedBox boundingBox;
<a name="l00372"></a>00372       Ogre::Real entityDiameter, entityRadius;
<a name="l00373"></a>00373       Ogre::Vector3 entityCenter;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375       <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> GUID;
<a name="l00376"></a>00376       <span class="keyword">static</span> <span class="keyword">inline</span> Ogre::String getUniqueID(<span class="keyword">const</span> Ogre::String &amp;prefix)
<a name="l00377"></a>00377       {
<a name="l00378"></a>00378          <span class="keywordflow">return</span> prefix + Ogre::StringConverter::toString(++GUID);
<a name="l00379"></a>00379       }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381       <span class="comment">//This will only be used when IMPOSTOR_FILE_SAVE is set to 0</span>
<a name="l00382"></a>00382       std::auto_ptr&lt;ImpostorTextureResourceLoader&gt; loader;
<a name="l00383"></a>00383    };
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00387"></a>00387    <span class="comment">//-------------------------------------------------------------------------------------</span>
<a name="l00388"></a>00388    <span class="comment">//This is an inline function from ImposterBatch that had to be defined down below the</span>
<a name="l00389"></a>00389    <span class="comment">//ImpostorTexture class, because it uses it.</span>
<a name="l00390"></a>00390    <span class="keyword">inline</span> <span class="keywordtype">void</span> ImpostorBatch::addBillboard(<span class="keyword">const</span> Ogre::Vector3 &amp;position, <span class="keyword">const</span> Ogre::Quaternion &amp;rotation,
<a name="l00391"></a>00391       <span class="keyword">const</span> Ogre::Vector3 &amp;scale, <span class="keyword">const</span> Ogre::ColourValue &amp;color)
<a name="l00392"></a>00392    {
<a name="l00393"></a>00393       <span class="comment">//float degrees = (Math::ACos(rotation.w)*2.0f).valueDegrees();</span>
<a name="l00394"></a>00394       <span class="keyword">const</span> Ogre::Vector3 zVector = rotation * Ogre::Vector3::UNIT_Z;
<a name="l00395"></a>00395       <span class="keywordtype">float</span> degrees = (float)Ogre::Math::ATan2(zVector.x, zVector.z).valueDegrees();
<a name="l00396"></a>00396       <span class="keywordflow">if</span> (degrees &lt; 0.f)
<a name="l00397"></a>00397          degrees += 360.f;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399       <span class="keywordtype">int</span> n = int(IMPOSTOR_YAW_ANGLES * (degrees / 360.0f) + 0.5f);
<a name="l00400"></a>00400       Ogre::uint16 texCoordIndx = (IMPOSTOR_YAW_ANGLES - n) % IMPOSTOR_YAW_ANGLES;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402       bbset-&gt;<a class="code" href="classForests_1_1StaticBillboardSet.html#ab62c3fb9cd3e089a6f9f0c10081bdadb" title="Adds a billboard to the StaticBillboardSet at the specified position.">createBillboard</a>(position + (rotation * entityBBCenter) * scale, 
<a name="l00403"></a>00403          <span class="keywordtype">float</span>(m_pTexture-&gt;entityDiameter * 0.5f * (scale.x + scale.z)),
<a name="l00404"></a>00404          <span class="keywordtype">float</span>(m_pTexture-&gt;entityDiameter * scale.y),
<a name="l00405"></a>00405          color, texCoordIndx);
<a name="l00406"></a>00406    }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 }  <span class="comment">// end namespace</span>
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 <span class="preprocessor">#endif</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 19 2013 09:55:43 for PagedGeometry by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
